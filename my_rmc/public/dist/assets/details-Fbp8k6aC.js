import{u as U,a as o,j as e,S as K,B as v,C as W,M as X,w as T,x as Y,N as D,k as u,y as ee,z as te,D as B,E as re,G as se,H as le,I as ie,n as ne}from"./index-BaNo5CCb.js";import{G as V}from"./iconBase-B74jWtjN.js";import{P as z}from"./Page-2P0Nf0AQ.js";import{u as oe,a as ae,b as ce,C as de,c as me,F as ge,f as I,T as ue,d as he,S as xe,e as pe,P as fe,g as ye,h as we,i as je,j as _,k as Se,l as ve,m as Ce,n as be}from"./columns-BIKscclf.js";import{g as ke}from"./getUserAgentBrowser-CKbUDlEF.js";import{a as Z,c as Ne,u as Fe,d as Re,b as Me}from"./useApiHook-BtkWmd9w.js";import{u as Pe,o as Ie}from"./index.esm-DcoOvalH.js";import{S as Ve,D as ze}from"./SearchSelect-BvAA0-qr.js";import{F as He}from"./Highlight-BnORE9D1.js";import{z as Te,F as E}from"./transition-DROugojl.js";import{y as Be,j as _e}from"./popover-B-gA93Kq.js";import{B as Ee,W as Le,T as Oe,j as Ae,K as Ge}from"./tabs-b8XE-8TI.js";import"./useUnmount-DQrccCT0.js";import"./Datepicker-BJEt3k2_.js";import"./XMarkIcon-DxPYgZFS.js";import"./listbox-DLCk8d2d.js";import"./frozen-DK-nIxO2.js";import"./use-text-value-XvfLNKvC.js";import"./ConfirmModal-C21Fj5Bu.js";import"./menu-DCEdUnXA.js";import"./PencilIcon-CcFN1zIe.js";import"./useMutation-DfjXeHZ5.js";import"./combobox-CRPlGvZi.js";import"./active-element-history-BN7lJHzC.js";import"./index-BwvjBoOX.js";import"./XMarkIcon-4wslb9xs.js";import"./floating-ui.dom-CtcSe9Ld.js";function Ue(t){return V({attr:{version:"1",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"rect",attr:{x:"7",y:"4",fill:"#BBDEFB",width:"34",height:"40"},child:[]},{tag:"g",attr:{fill:"#2196F3"},child:[{tag:"rect",attr:{x:"13",y:"26",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"18",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"34",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"10",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"26",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"18",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"34",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"10",width:"14",height:"4"},child:[]}]}]})(t)}function L(t){return V({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 6H3"},child:[]},{tag:"path",attr:{d:"M21 12H8"},child:[]},{tag:"path",attr:{d:"M21 18H8"},child:[]},{tag:"path",attr:{d:"M3 12v6"},child:[]}]})(t)}function O(t){return V({attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"rect",attr:{x:"7",y:"5.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"3.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"13.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"1.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"13",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"5",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"3",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"9",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"11",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"9.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"11.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"1",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M1 1.49994C1 1.2238 1.22386 0.999939 1.5 0.999939H6V1.99994H2V5.99994H1V1.49994ZM13 1.99994H9V0.999939H13.5C13.7761 0.999939 14 1.2238 14 1.49994V5.99994H13V1.99994ZM1 13.4999V8.99994H2V12.9999H6V13.9999H1.5C1.22386 13.9999 1 13.7761 1 13.4999ZM13 12.9999V8.99994H14V13.4999C14 13.7761 13.7761 13.9999 13.5 13.9999H9.5V12.9999H13Z",fill:"currentColor"},child:[]}]})(t)}function We({onClose:t,id:g,rootData:a}){const{isDark:x,darkColorScheme:c,lightColorScheme:p}=U(),h=a.options,[f,C]=o.useState([]),w=Object.fromEntries([...f].map(i=>[i,""])),{data:l,isLoading:j}=Z({doctype:h}),{data:b,isLoading:n}=Ne({doctype:h,id:g,fields:JSON.stringify(f)});o.useEffect(()=>{if(l!=null&&l.fields){const i=l.fields.filter(y=>y.read_only===0&&y.reqd).map(y=>y.fieldname);C(i)}},[l]);const N=Fe(i=>{i&&t({value:i.name,label:i[a==null?void 0:a.title_field]})}),d=Re(i=>{i&&t({value:i.name,label:i[a==null?void 0:a.title_field]})}),{register:F,handleSubmit:R,formState:{errors:k},control:M}=Pe({resolver:Ie(Ve(l==null?void 0:l.fields)),values:g?b:w}),P=i=>{g?d.mutate({doctype:h,body:{...i,id:g}}):N.mutate({doctype:h,body:i})};return g&&n||j?e.jsx(K,{style:{"--sk-color":x?c[700]:p[300]}}):(console.log(k),e.jsx(z,{title:"New Post Form",children:e.jsxs("div",{className:"transition-content px-10 pb-6",children:[e.jsxs("div",{className:"space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsx("div",{className:"items-center gap-1",children:e.jsxs("h2",{className:"line-clamp-1 text-xl mb-5 font-medium text-gray-700 dark:text-dark-50",children:["Add New ",h]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>t(),children:"Close"}),e.jsx(v,{className:"min-w-[7rem]",color:"primary",type:"button",onClick:R(P),form:"new-sub-post-form",children:"Save"})]})]}),e.jsx("form",{autoComplete:"off",id:"new-sub-post-form",children:e.jsx("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:e.jsx("div",{className:"col-span-12 lg:col-span-12",children:e.jsx(W,{className:"p-4 sm:px-5 overflow-y-auto max-h-screen",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(ze,{infos:l,ignorFields:[],fields:f,register:F,control:M,errors:k})})})})})})]})}))}const Ze=ke()==="Safari",qe="CRM List";function Je({tabData:t,customer:g}){const{cardSkin:a}=U(),[x,{open:c,close:p}]=X(!1),[h,f]=oe(),[C,w]=o.useState([]),{data:l}=Z({doctype:t==null?void 0:t.doctype}),[j,b]=o.useState({doctype:t==null?void 0:t.doctype,page:1,page_length:10,fields:null,filters:JSON.stringify([[t==null?void 0:t.doctype,t==null?void 0:t.filterName,"=",g]])}),{data:n}=Me(j);o.useEffect(()=>{if(l!=null&&l.fields){const s=l==null?void 0:l.fields.filter(r=>r.in_list_view).map(r=>r.fieldname);b({...j,fields:JSON.stringify([...s,"name"])})}},[l]),o.useEffect(()=>{n!=null&&n.data&&(n==null||n.data.map(s=>{s.details=!0}),w(n==null?void 0:n.data))},[n]);const N=s=>{s&&console.log(s.value),p()},[d,F]=o.useState({enableSorting:!0,enableColumnFilters:!0,enableFullScreen:!1,enableRowDense:!1}),[R,k]=o.useState(""),[M,P]=o.useState([]),[i,y]=T("column-visibility-orders-2",{}),[q,J]=T("column-pinning-orders-2",{}),H=o.useRef(),{width:Q}=ae({ref:H}),m=ce({data:C,columns:de(l==null?void 0:l.fields.filter(s=>s.in_list_view)),doctype:t==null?void 0:t.doctype,state:{globalFilter:R,sorting:M,columnVisibility:i,columnPinning:q,tableSettings:d},meta:{setTableSettings:F,deleteRow:s=>{f(),w(r=>r.filter(S=>S.order_id!==s.original.order_id))},deleteRows:s=>{f();const r=s.map(S=>S.original.order_id);w(S=>S.filter($=>!r.includes($.order_id)))}},filterFns:{fuzzy:_},enableSorting:d.enableSorting,enableColumnFilters:d.enableColumnFilters,getCoreRowModel:be(),onGlobalFilterChange:k,getFilteredRowModel:Ce(),getFacetedUniqueValues:ve(),getFacetedMinMaxValues:Se(),globalFilterFn:_,onSortingChange:P,getSortedRowModel:je(),getExpandedRowModel:we(),getRowCanExpand:()=>!0,getPaginationRowModel:ye(),onColumnVisibilityChange:y,onColumnPinningChange:J,autoResetPageIndex:h});return Y(()=>m.resetRowSelection(),[C]),me(d.enableFullScreen),e.jsxs(z,{title:qe,children:[e.jsxs("div",{className:"transition-content",children:[e.jsxs("div",{className:"flex items-center justify-between space-x-4 ",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(D,{value:m.getState().globalFilter,onChange:s=>m.setGlobalFilter(s.target.value),prefix:e.jsx(He,{className:"size-4"}),classNames:{input:"h-8 text-xs ring-primary-500/50 focus:ring-3",root:"shrink-0"},placeholder:"Search ..."})}),e.jsxs(v,{className:"h-8 space-x-1.5 rounded-md px-3 text-xs ",color:"primary",onClick:c,children:[e.jsx(ge,{className:"size-5"}),e.jsxs("span",{children:["New ",t==null?void 0:t.doctype]})]})]}),e.jsx("div",{className:u("flex flex-col pt-4",d.enableFullScreen&&"fixed inset-0 z-61 h-full w-full bg-white pt-3 dark:bg-dark-900"),children:e.jsxs(W,{className:u("relative mt-3 flex grow flex-col",d.enableFullScreen&&"overflow-hidden"),ref:H,children:[e.jsx("div",{className:"table-wrapper min-w-full grow overflow-x-auto",children:e.jsxs(ee,{hoverable:!0,dense:d.enableRowDense,sticky:d.enableFullScreen,className:"w-full text-left rtl:text-right",children:[e.jsx(te,{children:m.getHeaderGroups().map(s=>e.jsx(B,{children:s.headers.map(r=>e.jsxs(re,{className:u("bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100 first:ltr:rounded-tl-lg last:ltr:rounded-tr-lg first:rtl:rounded-tr-lg last:rtl:rounded-tl-lg",r.column.getCanPin()&&[r.column.getIsPinned()==="left"&&"sticky z-2 ltr:left-0 rtl:right-0",r.column.getIsPinned()==="right"&&"sticky z-2 ltr:right-0 rtl:left-0"]),children:[r.column.getCanSort()?e.jsxs("div",{className:"flex cursor-pointer select-none items-center space-x-3 ",onClick:r.column.getToggleSortingHandler(),children:[e.jsx("span",{className:"flex-1",children:r.isPlaceholder?null:I(r.column.columnDef.header,r.getContext())}),e.jsx(ue,{sorted:r.column.getIsSorted()})]}):r.isPlaceholder?null:I(r.column.columnDef.header,r.getContext()),r.column.getCanFilter()?e.jsx(he,{column:r.column}):null]},r.id))},s.id))}),e.jsx(se,{children:m.getRowModel().rows.map(s=>e.jsxs(o.Fragment,{children:[e.jsx(B,{className:u("relative border-y border-transparent border-b-gray-200 dark:border-b-dark-500",s.getIsExpanded()&&"border-dashed",s.getIsSelected()&&!Ze&&"row-selected after:pointer-events-none after:absolute after:inset-0 after:z-2 after:h-full after:w-full after:border-3 after:border-transparent after:bg-primary-500/10 ltr:after:border-l-primary-500 rtl:after:border-r-primary-500"),children:s.getVisibleCells().map(r=>e.jsxs(le,{className:u("relative",a==="shadow-sm"?"dark:bg-dark-700":"dark:bg-dark-900",r.column.getCanPin()&&[r.column.getIsPinned()==="left"&&"sticky z-2 ltr:left-0 rtl:right-0",r.column.getIsPinned()==="right"&&"sticky z-2 ltr:right-0 rtl:left-0"]),children:[r.column.getIsPinned()&&e.jsx("div",{className:u("pointer-events-none absolute inset-0 border-gray-200 dark:border-dark-500",r.column.getIsPinned()==="left"?"ltr:border-r rtl:border-l":"ltr:border-l rtl:border-r")}),I(r.column.columnDef.cell,r.getContext())]},r.id))}),s.getIsExpanded()&&e.jsx("tr",{children:e.jsx("td",{colSpan:s.getVisibleCells().length,className:"p-0",children:e.jsx(xe,{row:s,cardWidth:Q})})})]},s.id))})]})}),e.jsx(pe,{table:m}),m.getCoreRowModel().rows.length>0&&e.jsx("div",{className:u("px-4 pb-4 sm:px-5 sm:pt-4",d.enableFullScreen&&"bg-gray-50 dark:bg-dark-800",!(m.getIsSomeRowsSelected()||m.getIsAllRowsSelected())&&"pt-4"),children:e.jsx(fe,{table:m,count:(n==null?void 0:n.counts)??0,search:j,setSearch:b})})]})})]}),e.jsx(Te,{appear:!0,show:x,as:o.Fragment,children:e.jsxs(Be,{as:"div",className:"relative z-100",onClose:p,children:[e.jsx(E,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40"})}),e.jsx(E,{as:o.Fragment,enter:"ease-out transform-gpu transition-transform duration-200",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-200",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(_e,{className:"fixed right-0 top-0 flex h-full sm:w-[95%] md:w-[600px] transform-gpu flex-col bg-white transition-transform duration-200 dark:bg-dark-700",children:x&&e.jsx(We,{onClose:s=>N(s),id:null,rootData:{options:t==null?void 0:t.doctype,title_field:t==null?void 0:t.title_field}})})})]})})]})}const A="CRM Details",G=[{id:0,title:"Opportunity",doctype:"Opportunity",filterName:"customer_name",icon:L},{id:1,title:"Quotation",doctype:"Quotation",filterName:"customer_name",icon:L},{id:2,title:"Sales Order",doctype:"Sales Order",filterName:"customer",icon:O},{id:3,title:"Project",doctype:"Project",filterName:"customer",icon:O}];function St(){const{id:t}=ie(),g=ne(),[a,x]=o.useState(0);return e.jsx(z,{title:A,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ue,{className:"size-6"}),e.jsx("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:A})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(v,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>g(-1),children:"Back"})})]}),e.jsxs(Ee,{selectedIndex:a,onChange:x,children:[e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsx("div",{className:"w-max min-w-full border-b-2 border-gray-150 dark:border-dark-500",children:e.jsx(Le,{className:"-mb-0.5 flex",children:G.map(c=>e.jsxs(Oe,{className:({selected:p})=>u("shrink-0 space-x-2 whitespace-nowrap border-b-2 px-3 py-2 font-medium ",p?"border-primary-600 text-primary-600 dark:border-primary-500 dark:text-primary-400":"border-transparent hover:text-gray-800 focus:text-gray-800 dark:hover:text-dark-100 dark:focus:text-dark-100"),as:v,unstyled:!0,children:[e.jsx(c.icon,{className:"size-4.5"}),e.jsx("span",{children:c.title})]},c.id))})})}),e.jsx(Ae,{className:"mt-3",children:G.map(c=>e.jsx(Ge,{children:a===c.id&&e.jsx(Je,{tabData:c,customer:t})},c.id))})]})]})})}export{St as default};
