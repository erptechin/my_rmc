import{u as P,e as J,n as R,I as U,a as o,j as e,S as z,B as g,C as b}from"./index-f3r6umgb.js";import{u as T,o as q}from"./index.esm-BMFR-kb1.js";import{S as G,D as y}from"./SearchSelect-DAgorlIL.js";import{P as H}from"./Page-CZhRYwf3.js";import{a as K,c as L,u as M,d as Q}from"./useApiHook-CZnV53As.js";import{F as V}from"./DocumentPlusIcon-y-FpWJLf.js";import"./combobox-BXRS2Luv.js";import"./transition-Cc3pRxfh.js";import"./floating-ui.dom-CtcSe9Ld.js";import"./frozen-CEV0bN27.js";import"./active-element-history-HeLJeWOz.js";import"./Datepicker-Ma-0Q657.js";import"./popover-BlpAwzgS.js";import"./index-CM3VLHP_.js";import"./iconBase-GIGs6mnI.js";import"./ConfirmModal-MqYg-eza.js";import"./XMarkIcon-Xa9uEXuI.js";import"./useUnmount-BWDo5Kza.js";import"./useMutation-BJYoKC_t.js";const j="Driver",r="Driver",N=["full_name","employee","license_number","issuing_date","expiry_date"],S=["cell_number","status"];function xs(){var h;const{isDark:v,darkColorScheme:_,lightColorScheme:F}=P(),{user:l}=J(),c=R(),{id:a}=U(),[n,D]=o.useState(null),[w,k]=o.useState({}),p=(h=l==null?void 0:l.settings)!=null&&h.is_enable_branch?["custom_branch"]:[],{data:s,isFetching:C}=K({doctype:r,fields:JSON.stringify([...p,...N,...S])}),{data:t,isFetching:E}=L({doctype:r,id:a,fields:n?JSON.stringify(n):null});o.useEffect(()=>{if(s!=null&&s.fields){let i=s==null?void 0:s.fields.map(m=>m.fieldname);D(i),k(Object.fromEntries(i.map(m=>[m,""])))}},[s==null?void 0:s.fields]);const O=M(i=>{i&&(f(),c(-1))}),A=Q(i=>{i&&(f(),c(-1))}),{register:d,handleSubmit:I,formState:{errors:u},control:x,reset:f}=T({resolver:q(G(s==null?void 0:s.fields)),values:a?t:w}),B=i=>{a?((i==null?void 0:i.status)==="Draft"&&(s!=null&&s.is_submittable)&&(i.docstatus=1),A.mutate({doctype:r,body:{...i,id:a}})):O.mutate({doctype:r,body:i})};return C||E?e.jsx(z,{style:{"--sk-color":v?_[700]:F[300]}}):e.jsx(H,{title:(a?"Edit ":"New ")+j,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"size-6"}),e.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[a?"Edit":"New"," ",j]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>c(-1),children:"Back"}),e.jsx(g,{className:"min-w-[7rem]",color:(t==null?void 0:t.status)==="Draft"&&(s!=null&&s.is_submittable)?"success":"primary",type:"submit",form:"new-post-form",children:(t==null?void 0:t.status)==="Draft"&&(s!=null&&s.is_submittable)?"Submit":"Save"})]})]}),e.jsx("form",{autoComplete:"off",onSubmit:I(B),id:"new-post-form",children:e.jsxs("div",{className:"grid grid-cols-12 place-content-start gap-4 sm:gap-5 lg:gap-6",children:[e.jsx("div",{className:"col-span-12 lg:col-span-8",children:e.jsx(b,{className:"p-4 sm:px-5",children:e.jsx("div",{className:"mt-5 space-y-5",children:e.jsx(y,{infos:s,fields:N,register:d,control:x,errors:u,readOnly:(s==null?void 0:s.is_submittable)&&(t==null?void 0:t.docstatus)})})})}),e.jsx("div",{className:"col-span-12 space-y-4 sm:space-y-5 lg:col-span-4 lg:space-y-6",children:e.jsx(b,{className:"space-y-5 p-4 sm:px-5",children:e.jsx(y,{infos:s,fields:[...p,...S],register:d,control:x,errors:u,readOnly:(s==null?void 0:s.is_submittable)&&(t==null?void 0:t.docstatus)})})})]})})]})})}export{xs as default};
