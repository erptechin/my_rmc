import{u as $,M as q,a as s,w as v,x as J,j as e,N as K,B as w,k as c,C as X,y as Y,z as D,D as N,E as ee,G as te,H as re,I as le,n as ie}from"./index-CQSnfzOd.js";import{G as j}from"./iconBase-CJOE8E9s.js";import{P as z}from"./Page-BKi4U6qm.js";import{u as se,a as oe,b as ne,C as ae,c as de,F as ce,f as y,T as ge,d as me,S as ue,e as he,P as xe,g as pe,h as fe,i as ye,j as F,k as we,l as je,m as Ce,n as ke}from"./columns-4F4AuHeL.js";import{g as Se}from"./getUserAgentBrowser-CKAtWeZF.js";import{a as be,b as ve}from"./useApiHook-Cs2wJ3RW.js";import{A as Ne}from"./SearchSelect-D4EtsxKn.js";import{F as Fe}from"./Highlight-DiYPNEr3.js";import{z as Re,F as R}from"./transition-C7-MfEfP.js";import{y as Me,j as Pe}from"./popover-DONnzUWT.js";import{B as Ie,W as Ve,T as ze,j as He,K as Te}from"./tabs-DRgpo8ZG.js";import"./useUnmount-ii3bnVk5.js";import"./Datepicker-BbVjqDgu.js";import"./XMarkIcon-D09zHYKC.js";import"./listbox-CoK0bdKU.js";import"./frozen-DWK2MHln.js";import"./use-text-value-CdoHh_UI.js";import"./ConfirmModal-GnmGds5K.js";import"./menu-CLfdK7Np.js";import"./PencilIcon-DialpPqV.js";import"./useMutation-C20-WXgZ.js";import"./combobox-BErVCluG.js";import"./active-element-history-B-Uuw2gA.js";import"./index-C5dWWu73.js";import"./index.esm-pJJ70Kfz.js";import"./XMarkIcon-DN4cmKBN.js";import"./floating-ui.dom-CtcSe9Ld.js";function Be(t){return j({attr:{version:"1",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"rect",attr:{x:"7",y:"4",fill:"#BBDEFB",width:"34",height:"40"},child:[]},{tag:"g",attr:{fill:"#2196F3"},child:[{tag:"rect",attr:{x:"13",y:"26",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"18",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"34",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"13",y:"10",width:"4",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"26",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"18",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"34",width:"14",height:"4"},child:[]},{tag:"rect",attr:{x:"21",y:"10",width:"14",height:"4"},child:[]}]}]})(t)}function M(t){return j({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 6H3"},child:[]},{tag:"path",attr:{d:"M21 12H8"},child:[]},{tag:"path",attr:{d:"M21 18H8"},child:[]},{tag:"path",attr:{d:"M3 12v6"},child:[]}]})(t)}function P(t){return j({attr:{viewBox:"0 0 15 15",fill:"none"},child:[{tag:"rect",attr:{x:"7",y:"5.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"3.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"13.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"1.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"13",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"5",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"3",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"9",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"11",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"9.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"7",y:"11.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"rect",attr:{x:"1",y:"7.025",width:"1",height:"1",rx:".5",fill:"currentColor"},child:[]},{tag:"path",attr:{fillRule:"evenodd",clipRule:"evenodd",d:"M1 1.49994C1 1.2238 1.22386 0.999939 1.5 0.999939H6V1.99994H2V5.99994H1V1.49994ZM13 1.99994H9V0.999939H13.5C13.7761 0.999939 14 1.2238 14 1.49994V5.99994H13V1.99994ZM1 13.4999V8.99994H2V12.9999H6V13.9999H1.5C1.22386 13.9999 1 13.7761 1 13.4999ZM13 12.9999V8.99994H14V13.4999C14 13.7761 13.7761 13.9999 13.5 13.9999H9.5V12.9999H13Z",fill:"currentColor"},child:[]}]})(t)}const _e=Se()==="Safari",Ee="CRM List";function Oe({tabData:t,customer:x}){const{cardSkin:m}=$(),[u,{open:a,close:h}]=q(!1),[H,C]=se(),[k,p]=s.useState([]),{data:o}=be({doctype:t==null?void 0:t.doctype}),[f,S]=s.useState({doctype:t==null?void 0:t.doctype,page:1,page_length:10,fields:null,filters:JSON.stringify([[t==null?void 0:t.doctype,t==null?void 0:t.filterName,"=",x]])}),{data:i}=ve(f);s.useEffect(()=>{if(o!=null&&o.fields){const l=o==null?void 0:o.fields.filter(r=>r.in_list_view).map(r=>r.fieldname);S({...f,fields:JSON.stringify([...l,"name"])})}},[o]),s.useEffect(()=>{i!=null&&i.data&&(i==null||i.data.map(l=>{l.details=!0}),p(i==null?void 0:i.data))},[i]);const T=l=>{l&&console.log(l.value),h()},[d,B]=s.useState({enableSorting:!0,enableColumnFilters:!0,enableFullScreen:!1,enableRowDense:!1}),[_,E]=s.useState(""),[O,L]=s.useState([]),[A,G]=v("column-visibility-orders-2",{}),[U,W]=v("column-pinning-orders-2",{}),b=s.useRef(),{width:Z}=oe({ref:b}),n=ne({data:k,columns:ae(o==null?void 0:o.fields.filter(l=>l.in_list_view)),doctype:t==null?void 0:t.doctype,state:{globalFilter:_,sorting:O,columnVisibility:A,columnPinning:U,tableSettings:d},meta:{setTableSettings:B,deleteRow:l=>{C(),p(r=>r.filter(g=>g.order_id!==l.original.order_id))},deleteRows:l=>{C();const r=l.map(g=>g.original.order_id);p(g=>g.filter(Q=>!r.includes(Q.order_id)))}},filterFns:{fuzzy:F},enableSorting:d.enableSorting,enableColumnFilters:d.enableColumnFilters,getCoreRowModel:ke(),onGlobalFilterChange:E,getFilteredRowModel:Ce(),getFacetedUniqueValues:je(),getFacetedMinMaxValues:we(),globalFilterFn:F,onSortingChange:L,getSortedRowModel:ye(),getExpandedRowModel:fe(),getRowCanExpand:()=>!0,getPaginationRowModel:pe(),onColumnVisibilityChange:G,onColumnPinningChange:W,autoResetPageIndex:H});return J(()=>n.resetRowSelection(),[k]),de(d.enableFullScreen),e.jsxs(z,{title:Ee,children:[e.jsxs("div",{className:"transition-content",children:[e.jsxs("div",{className:"flex items-center justify-between space-x-4 ",children:[e.jsx("div",{className:"min-w-0",children:e.jsx(K,{value:n.getState().globalFilter,onChange:l=>n.setGlobalFilter(l.target.value),prefix:e.jsx(Fe,{className:"size-4"}),classNames:{input:"h-8 text-xs ring-primary-500/50 focus:ring-3",root:"shrink-0"},placeholder:"Search ..."})}),e.jsxs(w,{className:"h-8 space-x-1.5 rounded-md px-3 text-xs ",color:"primary",onClick:a,children:[e.jsx(ce,{className:"size-5"}),e.jsxs("span",{children:["New ",t==null?void 0:t.doctype]})]})]}),e.jsx("div",{className:c("flex flex-col pt-4",d.enableFullScreen&&"fixed inset-0 z-61 h-full w-full bg-white pt-3 dark:bg-dark-900"),children:e.jsxs(X,{className:c("relative mt-3 flex grow flex-col",d.enableFullScreen&&"overflow-hidden"),ref:b,children:[e.jsx("div",{className:"table-wrapper min-w-full grow overflow-x-auto",children:e.jsxs(Y,{hoverable:!0,dense:d.enableRowDense,sticky:d.enableFullScreen,className:"w-full text-left rtl:text-right",children:[e.jsx(D,{children:n.getHeaderGroups().map(l=>e.jsx(N,{children:l.headers.map(r=>e.jsxs(ee,{className:c("bg-gray-200 font-semibold uppercase text-gray-800 dark:bg-dark-800 dark:text-dark-100 first:ltr:rounded-tl-lg last:ltr:rounded-tr-lg first:rtl:rounded-tr-lg last:rtl:rounded-tl-lg",r.column.getCanPin()&&[r.column.getIsPinned()==="left"&&"sticky z-2 ltr:left-0 rtl:right-0",r.column.getIsPinned()==="right"&&"sticky z-2 ltr:right-0 rtl:left-0"]),children:[r.column.getCanSort()?e.jsxs("div",{className:"flex cursor-pointer select-none items-center space-x-3 ",onClick:r.column.getToggleSortingHandler(),children:[e.jsx("span",{className:"flex-1",children:r.isPlaceholder?null:y(r.column.columnDef.header,r.getContext())}),e.jsx(ge,{sorted:r.column.getIsSorted()})]}):r.isPlaceholder?null:y(r.column.columnDef.header,r.getContext()),r.column.getCanFilter()?e.jsx(me,{column:r.column}):null]},r.id))},l.id))}),e.jsx(te,{children:n.getRowModel().rows.map(l=>e.jsxs(s.Fragment,{children:[e.jsx(N,{className:c("relative border-y border-transparent border-b-gray-200 dark:border-b-dark-500",l.getIsExpanded()&&"border-dashed",l.getIsSelected()&&!_e&&"row-selected after:pointer-events-none after:absolute after:inset-0 after:z-2 after:h-full after:w-full after:border-3 after:border-transparent after:bg-primary-500/10 ltr:after:border-l-primary-500 rtl:after:border-r-primary-500"),children:l.getVisibleCells().map(r=>e.jsxs(re,{className:c("relative",m==="shadow-sm"?"dark:bg-dark-700":"dark:bg-dark-900",r.column.getCanPin()&&[r.column.getIsPinned()==="left"&&"sticky z-2 ltr:left-0 rtl:right-0",r.column.getIsPinned()==="right"&&"sticky z-2 ltr:right-0 rtl:left-0"]),children:[r.column.getIsPinned()&&e.jsx("div",{className:c("pointer-events-none absolute inset-0 border-gray-200 dark:border-dark-500",r.column.getIsPinned()==="left"?"ltr:border-r rtl:border-l":"ltr:border-l rtl:border-r")}),y(r.column.columnDef.cell,r.getContext())]},r.id))}),l.getIsExpanded()&&e.jsx("tr",{children:e.jsx("td",{colSpan:l.getVisibleCells().length,className:"p-0",children:e.jsx(ue,{row:l,cardWidth:Z})})})]},l.id))})]})}),e.jsx(he,{table:n}),n.getCoreRowModel().rows.length>0&&e.jsx("div",{className:c("px-4 pb-4 sm:px-5 sm:pt-4",d.enableFullScreen&&"bg-gray-50 dark:bg-dark-800",!(n.getIsSomeRowsSelected()||n.getIsAllRowsSelected())&&"pt-4"),children:e.jsx(xe,{table:n,count:(i==null?void 0:i.counts)??0,search:f,setSearch:S})})]})})]}),e.jsx(Re,{appear:!0,show:u,as:s.Fragment,children:e.jsxs(Me,{as:"div",className:"relative z-100",onClose:h,children:[e.jsx(R,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40"})}),e.jsx(R,{as:s.Fragment,enter:"ease-out transform-gpu transition-transform duration-200",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-200",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",children:e.jsx(Pe,{className:"fixed right-0 top-0 flex h-full sm:w-[95%] md:w-[600px] transform-gpu flex-col bg-white transition-transform duration-200 dark:bg-dark-700",children:u&&e.jsx(Ne,{onClose:l=>T(l),id:null,rootData:{options:t==null?void 0:t.doctype,title_field:t==null?void 0:t.title_field}})})})]})})]})}const I="CRM Details",V=[{id:0,title:"Opportunity",doctype:"Opportunity",filterName:"customer_name",icon:M},{id:1,title:"Quotation",doctype:"Quotation",filterName:"customer_name",icon:M},{id:2,title:"Sales Order",doctype:"Sales Order",filterName:"customer",icon:P},{id:3,title:"Project",doctype:"Project",filterName:"customer",icon:P}];function ut(){const{id:t}=le(),x=ie(),[m,u]=s.useState(0);return e.jsx(z,{title:I,children:e.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[e.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"size-6"}),e.jsx("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:I})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(w,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>x(-1),children:"Back"})})]}),e.jsxs(Ie,{selectedIndex:m,onChange:u,children:[e.jsx("div",{className:"hide-scrollbar overflow-x-auto",children:e.jsx("div",{className:"w-max min-w-full border-b-2 border-gray-150 dark:border-dark-500",children:e.jsx(Ve,{className:"-mb-0.5 flex",children:V.map(a=>e.jsxs(ze,{className:({selected:h})=>c("shrink-0 space-x-2 whitespace-nowrap border-b-2 px-3 py-2 font-medium ",h?"border-primary-600 text-primary-600 dark:border-primary-500 dark:text-primary-400":"border-transparent hover:text-gray-800 focus:text-gray-800 dark:hover:text-dark-100 dark:focus:text-dark-100"),as:w,unstyled:!0,children:[e.jsx(a.icon,{className:"size-4.5"}),e.jsx("span",{children:a.title})]},a.id))})})}),e.jsx(He,{className:"mt-3",children:V.map(a=>e.jsx(Te,{children:m===a.id&&e.jsx(Oe,{tabData:a,customer:t})},a.id))})]})]})})}export{ut as default};
