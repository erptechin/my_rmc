import{j as t,u as B,e as A,n as I,I as R,a as b,S as O,B as j}from"./index-OVyVeGx_.js";import{u as P,o as T}from"./index.esm-D6q5w4xC.js";import{S as U}from"./schema-jpqDMBo6.js";import{P as V}from"./Page-CNGiw8W6.js";import{R as z}from"./SearchSelect-Wl-9iSUV.js";import{a as H,c as J,u as L,d as M}from"./useApiHook-DQNTkRy4.js";import{F as q}from"./DocumentPlusIcon-CO1uob1A.js";import"./useUnmount-BMOfKNk-.js";import"./combobox-BcRSgAo9.js";import"./transition-SdOXiET7.js";import"./floating-ui.dom-CtcSe9Ld.js";import"./frozen-DJBr55WS.js";import"./active-element-history-BS-3893q.js";import"./Datepicker-CI2OghO0.js";import"./popover-sIVEBsao.js";import"./index-DeHCxfbq.js";import"./iconBase-V_-wMWBJ.js";import"./ConfirmModal-DxH5DHsp.js";import"./XMarkIcon-ZikdSwyh.js";import"./useMutation-W2OWZE4e.js";function G({infos:p,ignorFields:f,register:x,control:o,errors:n,tables:a}){const c=p.fields.reduce((s,r)=>{if(r.fieldtype=="HTML"||r.fieldtype=="Tab Break"||f.includes(r.fieldname))return s;if(r.fieldtype==="Section Break")s.push({isSection:!0,label:r.label,description:r.description,fields:[[]]});else if(r.fieldtype==="Column Break")s.length===0&&s.push({isSection:!0,fields:[[]]}),s[s.length-1].fields.push([]);else{s.length===0&&s.push({isSection:!0,fields:[[]]});const m=s[s.length-1];m.fields[m.fields.length-1].push(r)}return s},[]);return t.jsx("div",{className:"w-full space-y-2",children:c.map((s,r)=>t.jsxs("div",{children:[s.label&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:s.label}),s.description&&t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:s.description})]}),s.fields.some(m=>m.length>0)&&t.jsx("div",{className:"flex flex-col md:flex-row flex-wrap gap-4 border-[0.1px] border-gray-200 rounded-lg",children:s.fields.map((m,d)=>t.jsx("div",{className:"flex-1 min-w-[250px] px-4 md:y-4 sm:y-2",children:m.map((e,h)=>t.jsx(z,{item:e,control:o,register:x,errors:n,tables:a},h))},d))})]},r))})}const N="Vehicle",u="Vehicle";function pe(){var S;const{isDark:p,darkColorScheme:f,lightColorScheme:x}=B(),{user:o}=A(),n=I(),{id:a}=R(),[c,s]=b.useState(null),[r,m]=b.useState({}),d=(S=o==null?void 0:o.settings)!=null&&S.is_enable_branch?[]:["custom_branch"],{data:e,isFetching:h}=H({doctype:u}),{data:l,isFetching:v}=J({doctype:u,id:a,fields:c?JSON.stringify(c):null});b.useEffect(()=>{if(e!=null&&e.fields){let i=e==null?void 0:e.fields.map(g=>g.fieldname);s(i),m(Object.fromEntries(i.map(g=>[g,""])))}},[e==null?void 0:e.fields]);const w=L(i=>{i&&(y(),n(-1))}),F=M(i=>{i&&(y(),n(-1))}),{register:k,handleSubmit:C,formState:{errors:D},control:_,reset:y}=P({resolver:T(U(e==null?void 0:e.fields)),values:a?l:r}),E=i=>{a?((i==null?void 0:i.status)==="Draft"&&(e!=null&&e.is_submittable)&&(i.docstatus=1),delete i.last_odometer,F.mutate({doctype:u,body:{...i,id:a}})):w.mutate({doctype:u,body:i})};return h||v?t.jsx(O,{style:{"--sk-color":p?f[700]:x[300]}}):t.jsx(V,{title:(a?"Edit ":"New ")+N,children:t.jsxs("div",{className:"transition-content px-(--margin-x) pb-6",children:[t.jsxs("div",{className:"flex flex-col items-center justify-between space-y-4 py-5 sm:flex-row sm:space-y-0 lg:py-6",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(q,{className:"size-6"}),t.jsxs("h2",{className:"line-clamp-1 text-xl font-medium text-gray-700 dark:text-dark-50",children:[a?"Edit":"New"," ",N]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(j,{className:"min-w-[7rem]",variant:"outlined",color:"error",onClick:()=>n(-1),children:"Back"}),t.jsx(j,{className:"min-w-[7rem]",color:(l==null?void 0:l.status)==="Draft"&&(e!=null&&e.is_submittable)?"success":"primary",type:"submit",form:"new-post-form",children:(l==null?void 0:l.status)==="Draft"&&(e!=null&&e.is_submittable)?"Submit":"Save"})]})]}),t.jsx("form",{autoComplete:"off",onSubmit:C(E),id:"new-post-form",children:t.jsx(G,{infos:e,fields:c,ignorFields:d,register:k,control:_,errors:D,readOnly:(e==null?void 0:e.is_submittable)&&(l==null?void 0:l.docstatus)})})]})})}export{pe as default};
