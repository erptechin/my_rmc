import{a as l,aL as rt,aP as ot,b0 as J,j as s,l as E,aM as at,A as H,B as y,aN as it,R as lt,k as L,u as ct,M as pe,aO as dt,v as Fe,aq as de,N as Ee,at as ae,a4 as ut,C as ft,ah as mt,f as pt}from"./index-C7NFS0Jj.js";import{P as gt}from"./Page-BXPe8LrY.js";import{M as ht,H as xt}from"./index-B9fEnnNH.js";import{g as bt,m as jt,e as Ie,s as Ne,r as vt,F as Oe,a as ue,b as yt,c as wt,u as Tt,v as kt,w as Et,D as Nt,x as Ot}from"./DropIndicator-CkYzeIPu.js";import{F as St,b as Ct}from"./baseNavigation-Cx6BemLV.js";import{I as Dt}from"./index-C__FwSQP.js";import{F as Me,g as Rt}from"./getUserAgentBrowser-DtA_zdP4.js";import{F as _t}from"./UserIcon-D7u2ytvD.js";import{S as ze,D as Le}from"./SearchSelect-73dqdmHd.js";import{u as Ae,o as Pe}from"./index.esm-AnY9d5Y6.js";import{u as Ft,a as It,d as $e,e as Mt,b as zt}from"./useApiHook-BxVxwFVI.js";import{F as He}from"./XMarkIcon-ryiCjqOD.js";import{z as We,F as Z}from"./transition-DwXNaeNY.js";import{y as Be,j as Ge}from"./popover-99saVSlC.js";import{F as Ue}from"./PlusIcon-CPjLxqVw.js";import{F as ie,H as Lt}from"./Highlight-CfMIzU_7.js";import"./useUnmount-B2JOI3vI.js";import"./index-CiiTIu0-.js";import"./iconBase-CsWU8Jbo.js";import"./EnvelopeIcon-el5phjRI.js";import"./tabs-Cx7EWC24.js";import"./frozen-DeedMlbp.js";import"./react-apexcharts.min-DN9JSwZp.js";import"./listbox-DXV8V2DU.js";import"./use-text-value-CsoKydR5.js";import"./combobox-D4xABUq5.js";import"./active-element-history-DsI3nxiV.js";import"./Datepicker-o93YC6ZZ.js";import"./index-DQyyfbTJ.js";import"./ConfirmModal-plVG_b1G.js";import"./useMutation-D96EtCyv.js";import"./floating-ui.dom-CtcSe9Ld.js";function At({title:e,titleId:t,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?l.createElement("title",{id:t},e):null,l.createElement("path",{fillRule:"evenodd",d:"M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z",clipRule:"evenodd"}))}const Pt=l.forwardRef(At);function $t({title:e,titleId:t,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?l.createElement("title",{id:t},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 13.5V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 9.75V10.5"}))}const Ht=l.forwardRef($t);function Wt({title:e,titleId:t,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?l.createElement("title",{id:t},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5 7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5"}))}const Bt=l.forwardRef(Wt);function Gt({title:e,titleId:t,...r},n){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":t},r),e?l.createElement("title",{id:t},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0M3.124 7.5A8.969 8.969 0 0 1 5.292 3m13.416 0a8.969 8.969 0 0 1 2.168 4.5"}))}const Ut=l.forwardRef(Gt),[Vt,_]=rt("useTodoContext must be used within TodoProvider"),B=Symbol("todo");function Xt({todo:e,index:t,instanceId:r}){return{[B]:!0,todo:e,index:t,instanceId:r}}function Yt(){const e=new Map;function t({itemId:n,element:o}){return e.set(n,o),function(){e.delete(n)}}function r(n){return e.get(n)??null}return{register:t,getElement:r}}function K(e,t){return e[t]===!0}function qt({index:e,items:t}){return t.length===1?"only":e===0?"first":e===t.length-1?"last":"middle"}const Jt={infos:[],todos:[],doctype:"Task",fields:["name","subject","status","project","priority","exp_start_date","exp_end_date","expected_time","progress","description"],searchQuery:{subject:"",status:"Open",priority:"Low"},error:null},v={SET_INFOS:"SET_INFOS",SET_TODOS:"SET_TODOS",CREATE_TODO:"CREATE_TODO",UPDATE_TODO:"UPDATE_TODO",DELETE_TODO:"DELETE_TODO",TOGGLE_IMPORTANT:"TOGGLE_IMPORTANT",TOGGLE_DONE:"TOGGLE_DONE",SET_SEARCH:"SET_SEARCH",REORDER_TODOS:"REORDER_TODOS",SET_ERROR:"SET_ERROR"},Kt={[v.SET_INFOS]:(e,t)=>({...e,infos:t}),[v.SET_TODOS]:(e,t)=>({...e,todos:t,isLoading:!1}),[v.CREATE_TODO]:(e,t)=>({...e,todos:[t,...e.todos]}),[v.UPDATE_TODO]:(e,{id:t,updates:r})=>({...e,todos:e.todos.map(n=>n.id===t?{...n,...r}:n)}),[v.DELETE_TODO]:(e,t)=>({...e,todos:e.todos.filter(r=>r.id!==t)}),[v.TOGGLE_IMPORTANT]:(e,{id:t,value:r})=>({...e,todos:e.todos.map(n=>n.id===t?{...n,isImportant:r}:n)}),[v.TOGGLE_DONE]:(e,{id:t,value:r})=>({...e,todos:e.todos.map(n=>n.id===t?{...n,isDone:r}:n)}),[v.SET_SEARCH]:(e,t)=>({...e,searchQuery:t}),[v.REORDER_TODOS]:(e,{startIndex:t,finishIndex:r})=>{const n=vt({list:e.todos,startIndex:t,finishIndex:r});return{...e,todos:n}},[v.SET_ERROR]:(e,t)=>({...e,error:t,isLoading:!1})},Zt=Yt(),Se=()=>Symbol("instance-id"),Qt=(e,t)=>{const r=Kt[t.type];return r?r(e,t.payload):e};function Ve({children:e}){const[t,r]=l.useReducer(Qt,Jt),{infos:n,doctype:o,fields:a,todos:i,searchQuery:c,error:u}=t,d=l.useCallback(({startIndex:m,indexOfTarget:j,closestEdgeOfTarget:S})=>{const N=bt({startIndex:m,closestEdgeOfTarget:S,indexOfTarget:j,axis:"vertical"});N!==m&&r({type:v.REORDER_TODOS,payload:{startIndex:m,finishIndex:N}})},[]);l.useEffect(()=>jt({canMonitor({source:m}){return K(m.data,B)&&m.data.instanceId===Se},onDrop({location:m,source:j}){const S=m.current.dropTargets[0];if(!S)return;const N=j.data,F=S.data;if(!K(N,B)||!K(F,B))return;const X=i.findIndex(Y=>Y.id===F.todo.id);X<0||d({startIndex:N.index,indexOfTarget:X,closestEdgeOfTarget:Ie(F)})}}),[i,d]);const f=l.useCallback(m=>{r({type:v.SET_INFOS,payload:m})},[]),p=l.useCallback(()=>i.length,[i.length]),g=l.useCallback(m=>{const j={...m,id:ot(),slug:Ne(m.title),createdAt:new Date().toISOString(),isDone:!1,isImportant:!1};r({type:v.CREATE_TODO,payload:j}),J.success("Todo created successfully")},[]),h=l.useCallback((m,j)=>{const S={...j,slug:Ne(j.title),updatedAt:new Date().toISOString()};r({type:v.UPDATE_TODO,payload:{id:m,updates:S}}),J.success("Todo updated successfully")},[]),T=l.useCallback(m=>{r({type:v.DELETE_TODO,payload:m}),J.success("Todo deleted successfully")},[]),x=l.useCallback((m,j)=>{r({type:v.TOGGLE_IMPORTANT,payload:{id:m,value:j}})},[]),se=l.useCallback((m,j)=>{r({type:v.TOGGLE_DONE,payload:{id:m,value:j}}),j&&J.success("Todo marked as done")},[]),k=l.useCallback(m=>{r({type:v.SET_SEARCH,payload:m})},[]),V=l.useMemo(()=>({infos:n,setInfo:f,todos:i,registerTodo:Zt.register,error:u,createTodo:g,updateTodo:h,deleteTodo:T,setIsImportant:x,setIsDone:se,setSearchQuery:k,searchQuery:c,reorderTodo:d,instanceId:Se,getListLength:p,doctype:o,fields:a}),[g,T,u,p,d,c,se,x,k,i,h,n,f,o,a]);return s.jsx(Vt,{value:V,children:e})}Ve.propTypes={children:E.node};function es(){const{close:e}=at();return s.jsxs("div",{className:"relative flex h-18 w-full shrink-0 items-center justify-between pl-4 pr-1 rtl:pl-1 rtl:pr-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(H,{size:9,initialColor:"info",initialVariant:"soft",children:s.jsx(Dt,{className:"size-5 stroke-2"})}),s.jsx("p",{className:"truncate text-base tracking-wider text-gray-800 dark:text-dark-100",children:"Task"})]}),s.jsx(y,{onClick:e,isIcon:!0,variant:"flat",className:"size-7 rounded-full xl:hidden",children:s.jsx(it,{className:"size-6 rtl:rotate-180"})})]})}const le={Open:{id:"1",link:"#",messageCount:0,icon:St,color:"neutral"},Working:{id:"2",link:"#",messageCount:0,icon:ue,color:"neutral"},"Pending Review":{id:"3",link:"#",messageCount:0,icon:Oe,color:"neutral"},Overdue:{id:"4",link:"#",messageCount:0,icon:_t,color:"neutral"},Template:{id:"5",link:"#",messageCount:0,icon:ue,color:"neutral"},Completed:{id:"6",link:"#",messageCount:0,icon:Oe,color:"neutral"},Cancelled:{id:"7",link:"#",messageCount:0,icon:Me,color:"error"}};function ts(){const{infos:e,searchQuery:t,setSearchQuery:r}=_(),n=e.find(a=>a.fieldname==="status"),o=n==null?void 0:n.options.split(`
`);return s.jsx("ul",{className:"space-y-1.5 px-2 pt-4 font-medium",children:o&&o.map((a,i)=>{var c,u;return s.jsx("li",{children:s.jsx(y,{color:a===(t==null?void 0:t.status)?"primary":(c=le[a])==null?void 0:c.color,variant:a===(t==null?void 0:t.status)?"soft":"flat",className:"group w-full justify-between gap-2 p-2 text-xs-plus",onClick:()=>r({...t,status:(t==null?void 0:t.status)===a?null:a}),children:s.jsxs("div",{className:"flex gap-2",children:[((u=le[a])==null?void 0:u.icon)&&lt.createElement(le[a].icon,{className:L("size-4.5 transition-colors",a!==(t==null?void 0:t.status)&&"text-gray-400 group-hover:text-gray-500 group-focus:text-gray-500 dark:text-dark-300 dark:group-hover:text-dark-200 dark:group-focus:text-dark-200")}),s.jsx("span",{className:"truncate",children:a})]})})},i)})})}const ss={Low:{color:"success",text:"Low"},Medium:{color:"warning",text:"Medium"},High:{color:"error",text:"High"},Urgent:{color:"info",text:"Urgent"}};function ns(){const{infos:e,searchQuery:t,setSearchQuery:r}=_(),n=e.find(a=>a.fieldname==="priority"),o=n==null?void 0:n.options.split(`
`);return s.jsxs("div",{children:[s.jsx("div",{className:"flex min-w-0 items-center justify-between px-4",children:s.jsx("span",{className:"truncate text-tiny-plus font-medium uppercase",children:"Prioritys"})}),s.jsx("ul",{className:"space-y-1.5 px-2 pt-1 font-medium",children:o&&o.map(a=>{var i;return s.jsx("li",{children:s.jsx(y,{color:a===(t==null?void 0:t.priority)?"primary":"neutral",variant:a===(t==null?void 0:t.priority)?"soft":"flat",className:"group w-full justify-between gap-2 p-2 text-xs-plus",onClick:()=>r({...t,priority:(t==null?void 0:t.priority)===a?null:a}),children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(yt,{className:`size-4.5 stroke-2 text-this dark:text-this-light this:${(i=ss[a])==null?void 0:i.color}`}),s.jsx("span",{children:a})]})})},a)})})]})}const rs={depends_on:{task:!0,subject:!0},ignorFields:{naming_series:!0}};function ge({isOpen:e,close:t}){return s.jsxs(We,{appear:!0,show:e,as:Be,className:"relative z-100",onClose:t,children:[s.jsx(Z,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40"}),s.jsx(Z,{as:Ge,enter:"ease-out transform-gpu transition-transform duration-200",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-200",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed right-0 top-0 flex h-full w-full max-w-3xl transform-gpu flex-col bg-white transition-transform duration-200 dark:bg-dark-700",children:s.jsx(Xe,{close:t})})]})}function Xe({close:e}){const{infos:t,doctype:r,fields:n}=_(),[o,a]=l.useState({});l.useEffect(()=>{t&&a(Object.fromEntries(n.map(h=>[h,""])))},[t]);const i=Ft(h=>{h&&e()}),{register:c,handleSubmit:u,formState:{errors:d},control:f,setFocus:p}=Ae({resolver:Pe(ze(t)),defaultValues:o}),g=h=>{i.mutate({doctype:r,body:h})};return l.useEffect(()=>{p("subject")},[p]),s.jsxs("form",{className:"flex h-full flex-col",onSubmit:u(g),autoComplete:"off",children:[s.jsxs("header",{className:"flex h-14 items-center justify-between bg-gray-100 px-4 dark:bg-dark-800",children:[s.jsx("h3",{className:"text-base font-medium text-gray-800 dark:text-dark-100 p-2",children:"New Todo"}),s.jsx("div",{className:"flex items-center",children:s.jsx(y,{onClick:e,isIcon:!0,variant:"flat",className:"size-7 rounded-full",children:s.jsx(He,{className:"size-4.5"})})})]}),s.jsx("div",{className:"place-content-start gap-4 overflow-y-auto p-4 sm:grid-cols-2",children:s.jsx(Le,{infos:{fields:t},fields:n,tables:rs,register:c,control:f,errors:d})}),s.jsxs("div",{className:"flex justify-end gap-4 border-t border-gray-200 p-4 dark:border-dark-500",children:[s.jsx(y,{onClick:e,variant:"flat",className:"min-w-[8rem]",children:"Cancel"}),s.jsx(y,{type:"submit",color:"primary",className:"min-w-[8rem]",children:"Save"})]})]})}ge.propTypes={isOpen:E.bool,close:E.func};Xe.propTypes={close:E.func};function os(){const{setInfo:e,doctype:t,fields:r}=_(),{cardSkin:n}=ct(),[o,{open:a,close:i}]=pe(),{data:c}=It({doctype:t,fields:JSON.stringify(r)});return l.useEffect(()=>{c!=null&&c.fields&&e(c==null?void 0:c.fields)},[c]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:L("prime-panel flex flex-col",n==="shadow-sm"?"shadow-soft dark:shadow-dark-900/60":"dark:border-dark-600/80 ltr:border-r rtl:border-l"),children:s.jsxs("div",{className:L("flex h-full grow flex-col bg-white ltr:pl-(--main-panel-width) rtl:pr-(--main-panel-width)",n==="shadow-sm"?"dark:bg-dark-750":"dark:bg-dark-900"),children:[s.jsx(es,{}),s.jsxs(dt,{className:"hide-scrollbar grow overflow-y-auto",children:[s.jsx("div",{className:"px-4 pt-2",children:s.jsxs(y,{onClick:a,variant:"outlined",className:"w-full gap-2 rounded-full",children:[s.jsx(Ue,{className:"size-4"}),s.jsx("span",{children:"Add Task"})]})}),s.jsx(ts,{}),s.jsx("div",{className:"mx-4 my-4 h-px bg-gray-200 dark:bg-dark-500"}),s.jsx(ns,{})]})]})}),s.jsx(ge,{isOpen:o,close:i})]})}function as(){return s.jsxs(s.Fragment,{children:[s.jsx(ht,{nav:Ct,activeSegment:"/apps"}),s.jsx(os,{})]})}const is=new Date;function ls(){const{locale:e}=Fe(),{searchQuery:t,setSearchQuery:r}=_(),[n,{open:o,close:a}]=pe(),[i,c]=l.useState(!1),u=l.useRef();return l.useEffect(()=>{i&&u.current.focus()},[i]),s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"flex gap-2",children:s.jsx("p",{className:"text-xl font-medium text-gray-800 dark:text-dark-50",children:(t==null?void 0:t.status)||"Show All"})}),s.jsx("p",{className:"mt-1 text-xs",children:de(is).locale(e).format("dddd, MMM. DD")})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ee,{value:t==null?void 0:t.subject,onChange:d=>r({...t,subject:d.target.value}),classNames:{root:"max-md:hidden",input:"h-8 text-xs-plus"},placeholder:"Search here...",prefix:s.jsx(ie,{className:"size-4"})}),s.jsxs("div",{className:"flex",children:[s.jsx(y,{onClick:o,variant:"flat",isIcon:!0,className:"size-8",children:s.jsx(Ue,{className:"size-4.5"})}),s.jsx(y,{onClick:()=>c(!i),variant:"flat",isIcon:!0,className:"size-8 md:hidden",children:s.jsx(ie,{className:"size-4.5"})}),s.jsx(y,{variant:t.order_by=="modified asc"?"soft":"flat",isIcon:!0,className:"size-8",onClick:()=>r({...t,order_by:"modified desc"}),children:s.jsx(Bt,{className:"size-4.5"})}),s.jsx(y,{variant:t.order_by=="modified desc"?"soft":"flat",isIcon:!0,className:"size-8",onClick:()=>r({...t,order_by:"modified asc"}),children:s.jsx(Ht,{className:"size-4.5"})})]})]})]}),i&&s.jsx("div",{className:"pt-4 md:hidden",children:s.jsx(Ee,{ref:u,value:t==null?void 0:t.subject,onChange:d=>r({...t,subject:d.target.value}),placeholder:"Search here...",prefix:s.jsx(ie,{className:"size-4"})})}),s.jsx(ge,{isOpen:n,close:a})]})}const Ye=new Set,w=new WeakMap,A=new WeakMap,I=new WeakMap,fe=new WeakMap,cs=new WeakMap,P=new WeakMap,Q=new WeakMap,W=new WeakSet;let R,he=0,xe=0;const C="__aa_tgt",G="__aa_del",ee="__aa_new",ds=e=>{const t=hs(e);t&&t.forEach(r=>xs(r))},us=e=>{e.forEach(t=>{t.target===R&&ms(),w.has(t.target)&&M(t.target)})};function fs(e){const t=fe.get(e);t==null||t.disconnect();let r=w.get(e),n=0;const o=5;r||(r=$(e),w.set(e,r));const{offsetWidth:a,offsetHeight:i}=R,u=[r.top-o,a-(r.left+o+r.width),i-(r.top+o+r.height),r.left-o].map(f=>`${-1*Math.floor(f)}px`).join(" "),d=new IntersectionObserver(()=>{++n>1&&M(e)},{root:R,threshold:1,rootMargin:u});d.observe(e),fe.set(e,d)}function M(e){clearTimeout(Q.get(e));const t=te(e),r=U(t)?500:t.duration;Q.set(e,setTimeout(async()=>{const n=I.get(e);try{await(n==null?void 0:n.finished),w.set(e,$(e)),fs(e)}catch{}},r))}function ms(){clearTimeout(Q.get(R)),Q.set(R,setTimeout(()=>{Ye.forEach(e=>Ze(e,t=>qe(()=>M(t))))},100))}function ps(e){setTimeout(()=>{cs.set(e,setInterval(()=>qe(M.bind(null,e)),2e3))},Math.round(2e3*Math.random()))}function qe(e){typeof requestIdleCallback=="function"?requestIdleCallback(()=>e()):requestAnimationFrame(()=>e())}let me,z;const gs=typeof window<"u"&&"ResizeObserver"in window;gs&&(R=document.documentElement,me=new MutationObserver(ds),z=new ResizeObserver(us),window.addEventListener("scroll",()=>{xe=window.scrollY,he=window.scrollX}),z.observe(R));function hs(e){return e.reduce((n,o)=>[...n,...Array.from(o.addedNodes),...Array.from(o.removedNodes)],[]).every(n=>n.nodeName==="#comment")?!1:e.reduce((n,o)=>{if(n===!1)return!1;if(o.target instanceof Element){if(ce(o.target),!n.has(o.target)){n.add(o.target);for(let a=0;a<o.target.children.length;a++){const i=o.target.children.item(a);if(i){if(G in i)return!1;ce(o.target,i),n.add(i)}}}if(o.removedNodes.length)for(let a=0;a<o.removedNodes.length;a++){const i=o.removedNodes[a];if(G in i)return!1;i instanceof Element&&(n.add(i),ce(o.target,i),A.set(i,[o.previousSibling,o.nextSibling]))}}return n},new Set)}function ce(e,t){!t&&!(C in e)?Object.defineProperty(e,C,{value:e}):t&&!(C in t)&&Object.defineProperty(t,C,{value:e})}function xs(e){var t;const r=e.isConnected,n=w.has(e);r&&A.has(e)&&A.delete(e),I.has(e)&&((t=I.get(e))===null||t===void 0||t.cancel()),ee in e?Ce(e):n&&r?js(e):n&&!r?vs(e):Ce(e)}function O(e){return Number(e.replace(/[^0-9.\-]/g,""))}function bs(e){let t=e.parentElement;for(;t;){if(t.scrollLeft||t.scrollTop)return{x:t.scrollLeft,y:t.scrollTop};t=t.parentElement}return{x:0,y:0}}function $(e){const t=e.getBoundingClientRect(),{x:r,y:n}=bs(e);return{top:t.top+n,left:t.left+r,width:t.width,height:t.height}}function Je(e,t,r){let n=t.width,o=t.height,a=r.width,i=r.height;const c=getComputedStyle(e);if(c.getPropertyValue("box-sizing")==="content-box"){const d=O(c.paddingTop)+O(c.paddingBottom)+O(c.borderTopWidth)+O(c.borderBottomWidth),f=O(c.paddingLeft)+O(c.paddingRight)+O(c.borderRightWidth)+O(c.borderLeftWidth);n-=f,a-=f,o-=d,i-=d}return[n,a,o,i].map(Math.round)}function te(e){return C in e&&P.has(e[C])?P.get(e[C]):{duration:250,easing:"ease-in-out"}}function Ke(e){if(C in e)return e[C]}function be(e){const t=Ke(e);return t?W.has(t):!1}function Ze(e,...t){t.forEach(r=>r(e,P.has(e)));for(let r=0;r<e.children.length;r++){const n=e.children.item(r);n&&t.forEach(o=>o(n,P.has(n)))}}function je(e){return Array.isArray(e)?e:[e]}function U(e){return typeof e=="function"}function js(e){const t=w.get(e),r=$(e);if(!be(e))return w.set(e,r);let n;if(!t)return;const o=te(e);if(typeof o!="function"){const a=t.left-r.left,i=t.top-r.top,[c,u,d,f]=Je(e,t,r),p={transform:`translate(${a}px, ${i}px)`},g={transform:"translate(0, 0)"};c!==u&&(p.width=`${c}px`,g.width=`${u}px`),d!==f&&(p.height=`${d}px`,g.height=`${f}px`),n=e.animate([p,g],{duration:o.duration,easing:o.easing})}else{const[a]=je(o(e,"remain",t,r));n=new Animation(a),n.play()}I.set(e,n),w.set(e,r),n.addEventListener("finish",M.bind(null,e))}function Ce(e){ee in e&&delete e[ee];const t=$(e);w.set(e,t);const r=te(e);if(!be(e))return;let n;if(typeof r!="function")n=e.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:r.duration*1.5,easing:"ease-in"});else{const[o]=je(r(e,"add",t));n=new Animation(o),n.play()}I.set(e,n),n.addEventListener("finish",M.bind(null,e))}function De(e,t){var r;e.remove(),w.delete(e),A.delete(e),I.delete(e),(r=fe.get(e))===null||r===void 0||r.disconnect(),setTimeout(()=>{if(G in e&&delete e[G],Object.defineProperty(e,ee,{value:!0,configurable:!0}),t&&e instanceof HTMLElement)for(const n in t)e.style[n]=""},0)}function vs(e){var t;if(!A.has(e)||!w.has(e))return;const[r,n]=A.get(e);Object.defineProperty(e,G,{value:!0,configurable:!0});const o=window.scrollX,a=window.scrollY;if(n&&n.parentNode&&n.parentNode instanceof Element?n.parentNode.insertBefore(e,n):r&&r.parentNode?r.parentNode.appendChild(e):(t=Ke(e))===null||t===void 0||t.appendChild(e),!be(e))return De(e);const[i,c,u,d]=ws(e),f=te(e),p=w.get(e);(o!==he||a!==xe)&&ys(e,o,a,f);let g,h={position:"absolute",top:`${i}px`,left:`${c}px`,width:`${u}px`,height:`${d}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!U(f))Object.assign(e.style,h),g=e.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:f.duration,easing:"ease-out"});else{const[T,x]=je(f(e,"remove",p));(x==null?void 0:x.styleReset)!==!1&&(h=(x==null?void 0:x.styleReset)||h,Object.assign(e.style,h)),g=new Animation(T),g.play()}I.set(e,g),g.addEventListener("finish",De.bind(null,e,h))}function ys(e,t,r,n){const o=he-t,a=xe-r,i=document.documentElement.style.scrollBehavior;if(getComputedStyle(R).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+o,window.scrollY+a),!e.parentElement)return;const u=e.parentElement;let d=u.clientHeight,f=u.clientWidth;const p=performance.now();function g(){requestAnimationFrame(()=>{if(!U(n)){const h=d-u.clientHeight,T=f-u.clientWidth;p+n.duration>performance.now()?(window.scrollTo({left:window.scrollX-T,top:window.scrollY-h}),d=u.clientHeight,f=u.clientWidth,g()):document.documentElement.style.scrollBehavior=i}})}g()}function ws(e){const t=w.get(e),[r,,n]=Je(e,t,$(e));let o=e.parentElement;for(;o&&(getComputedStyle(o).position==="static"||o instanceof HTMLBodyElement);)o=o.parentElement;o||(o=document.body);const a=getComputedStyle(o),i=w.get(o)||$(o),c=Math.round(t.top-i.top)-O(a.borderTopWidth),u=Math.round(t.left-i.left)-O(a.borderLeftWidth);return[c,u,r,n]}function Ts(e,t={}){return me&&z&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!U(t)&&!t.disrespectUserMotionPreference||(W.add(e),getComputedStyle(e).position==="static"&&Object.assign(e.style,{position:"relative"}),Ze(e,M,ps,o=>z==null?void 0:z.observe(o)),U(t)?P.set(e,t):P.set(e,{duration:250,easing:"ease-in-out",...t}),me.observe(e,{childList:!0}),Ye.add(e))),Object.freeze({parent:e,enable:()=>{W.add(e)},disable:()=>{W.delete(e)},isEnabled:()=>W.has(e)})}function ks(e){const[t,r]=l.useState(),n=l.useMemo(()=>e,[]),o=l.useCallback(i=>{i instanceof HTMLElement?r(Ts(i,n)):r(void 0)},[n]),a=l.useCallback(i=>{t&&(i?t.enable():t.disable())},[t]);return[o,a]}function Es(e){return function(t){var r=t.container;return Object.assign(r.style,{borderLeft:"".concat(e.x," solid transparent"),borderTop:"".concat(e.y," solid transparent")}),{x:0,y:0}}}const Ns={depends_on:{task:!0,subject:!0},ignorFields:{naming_series:!0}};function Qe({data:e,isOpen:t,close:r}){return s.jsx(We,{appear:!0,show:t,as:l.Fragment,children:s.jsxs(Be,{as:"div",className:"relative z-100",onClose:r,children:[s.jsx(Z,{as:"div",enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity dark:bg-black/40"}),s.jsx(Z,{as:Ge,enter:"ease-out transform-gpu transition-transform duration-200",enterFrom:"translate-x-full",enterTo:"translate-x-0",leave:"ease-in transform-gpu transition-transform duration-200",leaveFrom:"translate-x-0",leaveTo:"translate-x-full",className:"fixed right-0 top-0 flex h-full w-full max-w-3xl transform-gpu flex-col bg-white transition-transform duration-200 dark:bg-dark-700",children:s.jsx(et,{data:e,close:r})})]})})}function et({data:e,close:t}){const{infos:r,doctype:n,fields:o}=_(),[a,i]=l.useState({});l.useEffect(()=>{r&&i(Object.fromEntries(o.map(x=>[x,""])))},[r]);const c=$e(x=>{x&&t()}),u=Mt(x=>{x&&t()}),{register:d,handleSubmit:f,formState:{errors:p},control:g,setFocus:h}=Ae({resolver:Pe(ze(r)),defaultValues:e});l.useEffect(()=>{h("subject")},[h]);const T=x=>{c.mutate({doctype:n,body:{...x,id:e.id}})};return s.jsxs("form",{className:"flex h-full flex-col",onSubmit:f(T),autoComplete:"off",children:[s.jsxs("header",{className:"flex h-14 items-center justify-between bg-gray-100 px-4 dark:bg-dark-800",children:[s.jsx("h3",{className:"text-base font-medium text-gray-800 dark:text-dark-100",children:"Edit Todo"}),s.jsx("div",{className:"flex items-center",children:s.jsx(y,{onClick:t,isIcon:!0,variant:"flat",className:"size-7 rounded-full",children:s.jsx(He,{className:"size-4.5"})})})]}),s.jsx("div",{className:"place-content-start gap-4 overflow-y-auto p-4 sm:grid-cols-2",children:s.jsx(Le,{infos:{fields:r},fields:o,tables:Ns,register:d,control:g,errors:p})}),s.jsxs("div",{className:"flex justify-between border-t border-gray-200 p-4 dark:border-dark-500",children:[s.jsxs(y,{onClick:()=>u.mutate({doctype:n,ids:[e.id]}),color:"error",className:"gap-2 md:min-w-[8rem]",children:[s.jsx(Me,{className:"size-4.5"}),s.jsx("div",{className:"max-md:hidden",children:"Delete"})]}),s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx(y,{onClick:t,variant:"flat",className:"min-w-[8rem]",children:"Cancel"}),s.jsx(y,{type:"submit",color:"primary",className:"min-w-[8rem]",children:"Save"})]})]})]})}Qe.propTypes={data:E.object,isOpen:E.bool,close:E.func};et.propTypes={data:E.object,close:E.func};const Re={type:"idle"},_e={type:"dragging"},Os=Rt()==="Safari",Ss="Task",Cs={Low:{color:"success"},Medium:{color:"warning"},High:{color:"error"},Urgent:{color:"info"}};function tt({todo:e,index:t}){var Y,ve,ye,we,Te;const{locale:r}=Fe(),[n,o]=l.useState(e.status==="Completed"),[a,{open:i,close:c}]=pe(),{setIsImportant:u,searchQuery:d,registerTodo:f,instanceId:p}=_(),{id:g,subject:h,exp_end_date:T,priority:x,color:se,assignedTo:k,isImportant:V}=e,[m,j]=l.useState(Re),[S,N]=l.useState(null),F=l.useRef(null),X=$e(b=>{b&&o(b.status==="Completed")});return l.useEffect(()=>{const b=F.current,ke=F.current;ae(b),ae(ke);const ne=Xt({todo:e,index:t,instanceId:p});return wt(f({itemId:ne.todo.id,element:b}),Et({element:b,dragHandle:ke,getInitialData:()=>ne,onGenerateDragPreview({nativeSetDragImage:D}){Os&&Ot({nativeSetDragImage:D,getOffset:Es({x:"16px",y:"8px"}),render({container:q}){return j({type:"preview-safari",container:q}),()=>j(_e)}})},onDragStart(){j(_e)},onDrop(){j(Re)}}),Tt({element:b,canDrop({source:D}){return K(D.data,B)&&D.data.instanceId===p},getData({input:D}){return kt(ne,{element:b,input:D,allowedEdges:["top","bottom"]})},onDrag({self:D,source:q}){if(q.element===b){N(null);return}const re=Ie(D.data),oe=q.data.index;ae(typeof oe=="number");const st=t===oe-1,nt=t===oe+1;if(st&&re==="bottom"||nt&&re==="top"){N(null);return}N(re)},onDragLeave(){N(null)},onDrop(){N(null)}}))},[t,p,f,e]),s.jsxs(s.Fragment,{children:[s.jsx("div",{className:L(t!==0&&"pt-4"),ref:F,children:s.jsxs(ft,{onClick:i,children:[s.jsxs("div",{className:L("cursor-pointer rounded-lg px-4 py-3",m.type==="dragging"&&"bg-primary-500/15"),children:[s.jsxs("div",{className:"flex min-w-0 items-center gap-2 sm:gap-3",children:[s.jsx(mt,{checked:n,onClick:b=>b.stopPropagation(),onChange:b=>X.mutate({doctype:Ss,body:{id:g,status:b.target.checked?"Completed":"Open"}}),className:"rounded-full"}),s.jsx("h2",{className:L(n&&"line-through","cursor-pointer truncate font-medium text-gray-800 dark:text-dark-100"),children:s.jsx(Lt,{query:d==null?void 0:d.subject,children:h})})]}),s.jsxs("div",{className:"mt-1 flex items-end justify-between",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 text-xs",children:[T&&s.jsxs(s.Fragment,{children:[s.jsx("p",{children:de(T).locale(r).format("DD MMM")}),s.jsx("div",{className:"my-0.5 w-px self-stretch bg-gray-200 dark:bg-dark-500"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Ut,{className:"size-3.5"}),s.jsx("span",{children:de(T).locale(r).format("HH:mm")})]})]}),x&&s.jsxs(l.Fragment,{children:[T&&s.jsx("div",{className:"my-0.5 w-px self-stretch bg-gray-200 dark:bg-dark-500"}),s.jsxs("span",{className:`inline-flex items-center gap-2 leading-none text-${(Y=Cs[x])==null?void 0:Y.color}`,children:[s.jsx("span",{className:"size-2 rounded-full bg-this dark:bg-this-lighter"}),s.jsx("span",{className:"text-this dark:text-this-lighter",children:x})]})]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(y,{onClick:b=>{b.stopPropagation(),u(g,!V)},isIcon:!0,variant:"flat",className:"size-6 rounded-full",children:V?s.jsx(Pt,{className:"size-4 text-primary-600 dark:text-primary-400"}):s.jsx(ue,{className:"size-4"})}),k&&k.length>0&&s.jsx("div",{className:"flex -space-x-1 ",children:k.length>3?s.jsxs(s.Fragment,{children:[s.jsx(H,{size:6,src:(ve=k[0])==null?void 0:ve.avatar,name:(ye=k[0])==null?void 0:ye.name,initialColor:"auto",classNames:{root:"origin-bottom transition-transform hover:z-10 hover:scale-125",display:"text-tiny-plus ring-1 ring-white dark:ring-dark-700"}}),s.jsx(H,{size:6,src:(we=k[1])==null?void 0:we.avatar,name:(Te=k[1])==null?void 0:Te.name,classNames:{root:"origin-bottom transition-transform hover:z-10 hover:scale-125",display:"text-tiny-plus ring-1 ring-white dark:ring-dark-700"}}),s.jsxs(H,{size:6,classNames:{root:"origin-bottom transition-transform hover:z-10 hover:scale-125",display:"text-tiny-plus ring-1 ring-white dark:ring-dark-700"},initialColor:"primary",children:["+",k.length-2]})]}):k.map(b=>s.jsx(H,{size:6,src:b.avatar,name:b.name,classNames:{root:"origin-bottom transition-transform hover:z-10 hover:scale-125",display:"text-tiny-plus ring-1 ring-white dark:ring-dark-700"}},b.uid))})]})]})]}),S&&s.jsx(Nt,{edge:S,gap:"19px"})]})}),m.type==="preview-safari"&&ut.createPortal(s.jsx(pt,{className:"h-5 max-w-sm rounded-sm bg-gray-200 px-1 py-0.5 text-black dark:bg-dark-800 dark:text-white",children:e.subject}),m.container),s.jsx(Qe,{isOpen:a,close:c,data:e})]})}tt.propTypes={todo:E.object,index:E.number,position:E.string};function Ds(){const{todos:e,doctype:t,fields:r,searchQuery:n}=_(),[o]=ks(),[a,i]=l.useState([]),[c,u]=l.useState({doctype:t,page:1,page_length:10,fields:JSON.stringify(r)}),{data:d}=zt(c);return l.useEffect(()=>{if(n){let f=[];n.subject&&f.push([t,"subject","=",n.subject]),n.priority&&f.push([t,"priority","=",n.priority]),n.status&&f.push([t,"status","=",n.status]),u({...c,filters:JSON.stringify(f),order_by:n==null?void 0:n.order_by})}},[n]),l.useEffect(()=>{d!=null&&d.data&&i(d==null?void 0:d.data)},[d]),s.jsx("div",{ref:o,className:"relative flex flex-col pt-4",children:a.map((f,p)=>s.jsx(tt,{todo:f,index:p,position:qt({index:p,items:e})},f.name))})}function fn(){return s.jsx(gt,{title:"Opportunity",children:s.jsxs(Ve,{children:[s.jsx(xt,{}),s.jsxs("main",{className:"main-content transition-content grid grid-cols-1 place-content-start px-(--margin-x) pb-6 pt-5",children:[s.jsx(ls,{}),s.jsx(Ds,{})]}),s.jsx(as,{})]})})}export{fn as default};
